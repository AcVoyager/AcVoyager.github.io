<!DOCTYPE html>
<html lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"acvoyager.github.io","root":"/","scheme":"Gemini","version":"8.0.0-rc.3","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="欢迎来到我的AWS学习笔记系列。 本文着重记述关于如何创建一个AWS环境，创建环境时的注意事项。如若转载，请先与作者联系。 本文图片来自于网络">
<meta property="og:type" content="article">
<meta property="og:title" content="AWS学习笔记: How to design an environment">
<meta property="og:url" content="https://acvoyager.github.io/2020/10/28/AWS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-How-to-design-an-environment/index.html">
<meta property="og:site_name" content="The Black Pearl">
<meta property="og:description" content="欢迎来到我的AWS学习笔记系列。 本文着重记述关于如何创建一个AWS环境，创建环境时的注意事项。如若转载，请先与作者联系。 本文图片来自于网络">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://acvoyager.github.io/2020/10/28/AWS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-How-to-design-an-environment/1.png">
<meta property="og:image" content="https://acvoyager.github.io/2020/10/28/AWS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-How-to-design-an-environment/2.png">
<meta property="og:image" content="https://acvoyager.github.io/2020/10/28/AWS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-How-to-design-an-environment/3.png">
<meta property="og:image" content="https://acvoyager.github.io/2020/10/28/AWS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-How-to-design-an-environment/4.png">
<meta property="og:image" content="https://acvoyager.github.io/2020/10/28/AWS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-How-to-design-an-environment/5.png">
<meta property="og:image" content="https://acvoyager.github.io/2020/10/28/AWS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-How-to-design-an-environment/6.png">
<meta property="og:image" content="https://acvoyager.github.io/2020/10/28/AWS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-How-to-design-an-environment/7.png">
<meta property="og:image" content="https://acvoyager.github.io/2020/10/28/AWS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-How-to-design-an-environment/8.png">
<meta property="og:image" content="https://acvoyager.github.io/2020/10/28/AWS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-How-to-design-an-environment/9.png">
<meta property="og:image" content="https://acvoyager.github.io/2020/10/28/AWS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-How-to-design-an-environment/10.png">
<meta property="article:published_time" content="2020-10-28T21:40:01.000Z">
<meta property="article:modified_time" content="2020-10-30T22:29:41.619Z">
<meta property="article:author" content="Voyager">
<meta property="article:tag" content="AWS">
<meta property="article:tag" content="Network">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://acvoyager.github.io/2020/10/28/AWS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-How-to-design-an-environment/1.png">

<link rel="canonical" href="https://acvoyager.github.io/2020/10/28/AWS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-How-to-design-an-environment/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>AWS学习笔记: How to design an environment | The Black Pearl</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-168368135-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-168368135-1');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line toggle-line-first"></span>
        <span class="toggle-line toggle-line-middle"></span>
        <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">The Black Pearl</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://acvoyager.github.io/2020/10/28/AWS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-How-to-design-an-environment/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Voyager">
      <meta itemprop="description" content="Seek, and you shall find.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="The Black Pearl">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AWS学习笔记: How to design an environment
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-28 14:40:01" itemprop="dateCreated datePublished" datetime="2020-10-28T14:40:01-07:00">2020-10-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-30 15:29:41" itemprop="dateModified" datetime="2020-10-30T15:29:41-07:00">2020-10-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%B8%AD%E6%96%87-English/" itemprop="url" rel="index"><span itemprop="name">中文, English</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-users"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="firestore-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2020/10/28/AWS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-How-to-design-an-environment/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/10/28/AWS学习笔记-How-to-design-an-environment/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>欢迎来到我的AWS学习笔记系列。</p>
<p>本文着重记述关于如何创建一个AWS环境，创建环境时的注意事项。如若转载，请先与作者联系。</p>
<p><em>本文图片来自于网络</em></p>
<a id="more"></a>

<h1 id="How-to-design-an-environment"><a href="#How-to-design-an-environment" class="headerlink" title="How to design an environment"></a>How to design an environment</h1><h2 id="I-How-to-choose-a-region"><a href="#I-How-to-choose-a-region" class="headerlink" title="I. How to choose a region"></a>I. How to choose a region</h2><p>Data sovereignty and compliance.</p>
<p>Proximity of users to data.</p>
<ul>
<li>Some regions are more expensive than the others.</li>
<li>100ms delays can cost 1% dropping sales on Amazon.com.</li>
</ul>
<p>Availability of services and features</p>
<ul>
<li>Some services are available in limited regions.</li>
<li>Some can cross regions, but at increased latency.</li>
</ul>
<p>Cost-effectiveness</p>
<ul>
<li>Services costs vary by Region.</li>
<li>Some have costs for transferring data out.</li>
<li>Best at least two regions.</li>
<li>Replicating entire environment to another region.</li>
</ul>
<h2 id="II-How-many-availability-zones-to-use"><a href="#II-How-many-availability-zones-to-use" class="headerlink" title="II. How many availability zones to use?"></a>II. How many availability zones to use?</h2><p>Start with 2 az per region.<br>  <img src="1.png" alt=""></p>
<p>For the following scenarios:</p>
<ul>
<li>heavily use Amazon EC2 Spot Instances -&gt; 2 az</li>
<li>applications with MySQL, SQL server, Oracle data sources -&gt; 2 az to support active/passive</li>
<li>applications with data sources Cassandra/MongoDB -&gt; 2 or more az for extremely high availability</li>
</ul>
<h2 id="III-VPC"><a href="#III-VPC" class="headerlink" title="III. VPC"></a>III. VPC</h2><p>Using one VPC</p>
<ul>
<li>High-performance computing environment</li>
<li>Microsoft active directory for identity management.</li>
<li>Small, single applications managed by very small team.</li>
</ul>
<p>Most cases, there are two primary patterns for organizing the infrastructure:</p>
<p>Multi-VPC or Multi-Account.<br><img src="2.png" alt=""></p>
<p>Multi-VPC pattern:</p>
<ul>
<li>For single team or organization</li>
<li>Limited teams make maintaining standards and managing access easier.</li>
</ul>
<p>Multi-Account pattern</p>
<ul>
<li>Larger organizations</li>
<li>Organizations with multiple IT teams</li>
<li>Medium-sized organizations that grow fast.</li>
</ul>
<p>AWS Organizations</p>
<ul>
<li>Hierarchical grouping of accounts</li>
<li>Integration and support of IAM</li>
<li>Integration of other AWS services</li>
<li>Data replication with eventually consistency</li>
<li>Caching may improve performance.</li>
</ul>
<p><img src="3.png" alt=""></p>
<h2 id="IV-Divide-the-VPC-to-subnets"><a href="#IV-Divide-the-VPC-to-subnets" class="headerlink" title="IV. Divide the VPC to subnets"></a>IV. Divide the VPC to subnets</h2><p>Classless Inter-Domain Routing(CIDR).</p>
<p>Amazon VPC can use CIDR ranges between /16 to /28.</p>
<p>/16: 256 * 256 = 65536</p>
<p>/28: 2^4 = 16</p>
<p><img src="4.png" alt=""></p>
<p>For each subnets, there are five ip address unavailable because they are reserved. </p>
<p>Private subnet: Include a routing table entry to an <strong>internet gateway</strong> to support inbound/outbound traffic.</p>
<p>Public subnet: Don’t have such routing table so cannot be accessed to the internet gateway. But can use a “jump box” – which is a (NAT/proxy/bastion host) to support <strong>restricted</strong>, <strong>outbound-only</strong> public network access.</p>
<p><strong>Note:</strong> The majority of the network resources should be hosted into <strong>private subnet</strong>.</p>
<p><strong>Recommendation</strong>:</p>
<ul>
<li>subnet size. Consider larger subnets over smaller ones(/24, and larget)</li>
<li>subnet type<ul>
<li>Data store instances: private</li>
<li>Batch processing instances: private</li>
<li>Backend instances: private</li>
<li>Web application instances: public or private</li>
</ul>
</li>
</ul>
<h2 id="V-Default-VPCs-and-Default-Subnets"><a href="#V-Default-VPCs-and-Default-Subnets" class="headerlink" title="V. Default VPCs and Default Subnets"></a>V. Default VPCs and Default Subnets</h2><p>Default VPC</p>
<ul>
<li>Each region in the account has one default VPC.</li>
<li>Default CIDR for the default VPC: 172.32.0.0/16</li>
<li>include a default subnet, gateway, main route table, security group and Network ACL.</li>
</ul>
<p>Default subnet in default VPCs</p>
<ul>
<li>Created within each AZ for each VPC.</li>
<li>public, with CIDR block of /20</li>
<li>Whenever add a AZ, place a subnet in it.</li>
</ul>
<p><strong>Recommendations</strong>:</p>
<ul>
<li>Use default VPCs and subnets to experiment with the AWS account only.</li>
<li>For real-world applications, create your own VPCs and subnets.</li>
</ul>
<h2 id="VI-Controlling-VPC-Traffic"><a href="#VI-Controlling-VPC-Traffic" class="headerlink" title="VI. Controlling VPC Traffic"></a>VI. Controlling VPC Traffic</h2><p>Route tables:</p>
<ul>
<li>Main(default) and custom route tables</li>
<li>All route tables include a local route entry<ul>
<li>10.0.0.0/16 -&gt; local</li>
<li>The local entry cannot be deleted</li>
<li>Only one route table per subnet</li>
</ul>
</li>
<li><em>Best practice</em>: Use custom route tables for each subnet.</li>
</ul>
<p>Security groups:</p>
<ul>
<li>Stateful applications that act as virtual firewalls</li>
<li>By default<ul>
<li>Deny all inbound traffic</li>
<li>Allow all outbound traffic</li>
<li>Use allow rules to filter based on protocols</li>
</ul>
</li>
<li>If inbound is allowed, then the outbound response is allowed automatically.</li>
</ul>
<p><img src="5.png" alt=""></p>
<p>Unless required for the compliance, it is not recommended to modify the default security group.</p>
<p>Create security groups with inbound rules for each <strong>funtional tier</strong>(web/app/data) within an applications.</p>
<p><img src="6.png" alt=""></p>
<p>Network ACLs</p>
<ul>
<li>Virtual firewall</li>
<li>When creating new one, automatically configured to <strong>DENY All</strong> traffic. </li>
</ul>
<p>Internet Gateways</p>
<ul>
<li>Horizontally scaled, redundant, and highly available.</li>
<li>To enable access to or from the Internet:<ul>
<li>Attach the gateway to the VPC</li>
<li>Ensure subnets’ route table points to the gateway</li>
<li>Ensure the instances have public IP address/Elastic IP address</li>
<li>Ensure the NACLs and security groups allow the relevant traffic</li>
</ul>
</li>
</ul>
<p>Outbound from private instances</p>
<ul>
<li>Enable NAT</li>
<li>Two options:<ul>
<li>Amazon EC2 instance set up as a NAT in a public subnet</li>
<li>NAT Gateway.</li>
<li>Both these two are in the public subnet.</li>
</ul>
</li>
</ul>
<p><img src="7.png" alt=""></p>
<p>Amazon VPC Flow logs</p>
<ul>
<li>Capture traffic flow details in your VPC</li>
<li>Can be enabled for VPCs, subnets, and ENIs</li>
<li>Publish logs to CloudWatch Logs.</li>
</ul>
<h2 id="VII-Connect-multiple-VPCs"><a href="#VII-Connect-multiple-VPCs" class="headerlink" title="VII. Connect multiple VPCs"></a>VII. Connect multiple VPCs</h2><p>VPN Hub and Spoke Architecture</p>
<ul>
<li>Two Amazon EC2-based VPN endpoints in each spoke to support high availability</li>
<li>Central VPC(hub) that contains common services for all application VPCs</li>
<li>Dynamic routing protocol between the spokes and the hub</li>
</ul>
<p>Resolution: VPC Peering<br>To establish a VPC peering connection:</p>
<ul>
<li>One sends a request, another one accepts to activate.</li>
<li>To enable, add a route pointing to IP address range of peer VPC</li>
<li>Update security groups</li>
<li>VPC peering connection is one-to-one relationship between two VPCs</li>
<li><strong>Note:</strong> Now VPC peering can cross different regions, through AWS backbone, never travel through the public Internet.</li>
<li>VPC peering is not transitive.</li>
</ul>
<h2 id="VIII-Integrating-On-Premises-Components"><a href="#VIII-Integrating-On-Premises-Components" class="headerlink" title="VIII. Integrating On-Premises Components"></a>VIII. Integrating On-Premises Components</h2><p>VPN-connections</p>
<ul>
<li>Amazon Virtual Gateway(VGW). </li>
<li>Dynamic routing uses Border Gateway Protocols, or BGP, peering to exchange routing information.</li>
<li>AWS managed VPN supports up to 1.25 Gbps throughout per VPN tunnel.</li>
</ul>
<p>AWS Direct Connect</p>
<ul>
<li>Dedicated, private fiber to AWS.</li>
<li>Create virtual interfaces(VIF) directly to AWS cloud.</li>
</ul>
<p>High Resiliency for Critical Workloads</p>
<p><img src="8.png" alt=""></p>
<p>Maximum Resiliency for Critical Workloads</p>
<p><img src="9.png" alt=""></p>
<p>Dual DX-Dual Location</p>
<p><img src="10.png" alt=""></p>
<h2 id="VIV-VPC-Best-practices"><a href="#VIV-VPC-Best-practices" class="headerlink" title="VIV. VPC Best practices"></a>VIV. VPC Best practices</h2><p>Best practice:</p>
<ul>
<li>Choose CIDR block or IP address ranges wisely. Plan ahead.</li>
<li>Use subnets to divide resources based on access.</li>
<li>Use Multi-AZ deployments in VPC for high availability.</li>
<li>Use security groups to control traffic between resources.</li>
<li>Use VPC FLow Logs to track and monitor the VPC traffic.</li>
<li>Check the health of the VPN link via API calls or AWS Management Console.</li>
</ul>
<p>Common practice:</p>
<ul>
<li>Replicate the architecture across two/more AZ.</li>
<li>Use NAT gateway to be in place of NAR instances. But which is on earth more appropriate? Check the previous content.</li>
<li>If resources in multiple AZs share one NAT gateway, that is not recommended because if that gateway’s AZ is down, all resources in other AZ will be down. So in order to create AZ-independent architecture, be mind to create one gateway to each AZ.</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/AWS/" rel="tag"># AWS</a>
              <a href="/tags/Network/" rel="tag"># Network</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/10/26/Java-%E7%BC%96%E8%AF%91%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/" rel="prev" title="Java 编译打包过程记录">
      <i class="fa fa-chevron-left"></i> Java 编译打包过程记录
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#How-to-design-an-environment"><span class="nav-number">1.</span> <span class="nav-text">How to design an environment</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#I-How-to-choose-a-region"><span class="nav-number">1.1.</span> <span class="nav-text">I. How to choose a region</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#II-How-many-availability-zones-to-use"><span class="nav-number">1.2.</span> <span class="nav-text">II. How many availability zones to use?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#III-VPC"><span class="nav-number">1.3.</span> <span class="nav-text">III. VPC</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IV-Divide-the-VPC-to-subnets"><span class="nav-number">1.4.</span> <span class="nav-text">IV. Divide the VPC to subnets</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#V-Default-VPCs-and-Default-Subnets"><span class="nav-number">1.5.</span> <span class="nav-text">V. Default VPCs and Default Subnets</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VI-Controlling-VPC-Traffic"><span class="nav-number">1.6.</span> <span class="nav-text">VI. Controlling VPC Traffic</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VII-Connect-multiple-VPCs"><span class="nav-number">1.7.</span> <span class="nav-text">VII. Connect multiple VPCs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VIII-Integrating-On-Premises-Components"><span class="nav-number">1.8.</span> <span class="nav-text">VIII. Integrating On-Premises Components</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VIV-VPC-Best-practices"><span class="nav-number">1.9.</span> <span class="nav-text">VIV. VPC Best practices</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Voyager</p>
  <div class="site-description" itemprop="description">Seek, and you shall find.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/AcVoyager" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;AcVoyager" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:xcvoyager01@gmail.com" title="E-Mail → mailto:xcvoyager01@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Voyager</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        




  <script src="https://www.gstatic.com/firebasejs/6.3.3/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.3.3/firebase-firestore.js"></script>
  <script>
    firebase.initializeApp({
      apiKey   : 'AIzaSyDY9_gdwlZQh3pD0aOUUt4qoOuS_Cnn7L8',
      projectId: 'my-blog-9d335'
    });

    function getCount(doc, increaseCount) {
      // IncreaseCount will be false when not in article page
      return doc.get().then(d => {
        var count = 0;
        if (!d.exists) { // Has no data, initialize count
          if (increaseCount) {
            doc.set({
              count: 1
            });
            count = 1;
          }
        } else { // Has data
          count = d.data().count;
          if (increaseCount) {
            // If first view this article
            doc.set({ // Increase count
              count: count + 1
            });
            count++;
          }
        }

        return count;
      });
    }

    function appendCountTo(el) {
      return count => {
        el.innerText = count;
      }
    }
  </script>
  <script>
    (function() {
      var db = firebase.firestore();
      var articles = db.collection('articles');

      if (CONFIG.page.isPost) { // Is article page
        var title = document.querySelector('.post-title').innerText.trim();
        var doc = articles.doc(title);
        var increaseCount = CONFIG.hostname === location.hostname;
        if (localStorage.getItem(title)) {
          increaseCount = false;
        } else {
          // Mark as visited
          localStorage.setItem(title, true);
        }
        getCount(doc, increaseCount).then(appendCountTo(document.querySelector('.firestore-visitors-count')));
      } else if (CONFIG.page.isHome) { // Is index page
        var promises = [...document.querySelectorAll('.post-title')].map(element => {
          var title = element.innerText.trim();
          var doc = articles.doc(title);
          return getCount(doc);
        });
        Promise.all(promises).then(counts => {
          var metas = document.querySelectorAll('.firestore-visitors-count');
          counts.forEach((val, idx) => {
            appendCountTo(metas[idx])(val);
          });
        });
      }
    })();
  </script>




      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://voyager.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://acvoyager.github.io/2020/10/28/AWS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-How-to-design-an-environment/";
    this.page.identifier = "2020/10/28/AWS学习笔记-How-to-design-an-environment/";
    this.page.title = "AWS学习笔记: How to design an environment";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://voyager.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>
